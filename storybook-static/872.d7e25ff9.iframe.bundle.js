/*! For license information please see 872.d7e25ff9.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunknextjs=self.webpackChunknextjs||[]).push([[872],{"./hooks/useAuth.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>useAuth});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),firebase_auth__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/firebase/auth/dist/esm/index.esm.js"),_lib_firebaseClient__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./lib/firebaseClient.ts");function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _regenerator(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var c=n&&n.prototype instanceof Generator?n:Generator,u=Object.create(c.prototype);return _regeneratorDefine2(u,"_invoke",function(r,n,o){var i,c,u,f=0,p=o||[],y=!1,G={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function d(t,r){return i=t,c=0,u=e,G.n=r,a}};function d(r,n){for(c=r,u=n,t=0;!y&&f&&!o&&t<p.length;t++){var o,i=p[t],d=G.p,l=i[2];r>3?(o=l===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=e):i[0]<=d&&((o=r<2&&d<i[1])?(c=0,G.v=n,G.n=i[1]):d<l&&(o=r<3||i[0]>n||n>l)&&(i[4]=r,i[5]=n,G.n=l,c=0))}if(o||r>1)return a;throw y=!0,n}return function(o,p,l){if(f>1)throw TypeError("Generator is already running");for(y&&1===p&&d(p,l),c=p,u=l;(t=c<2?e:u)||!y;){i||(c?c<3?(c>1&&(G.n=-1),d(c,u)):G.n=u:G.v=u);try{if(f=2,i){if(c||(o="next"),t=i[o]){if(!(t=t.call(i,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,c<2&&(c=0)}else 1===c&&(t=i.return)&&t.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=e}else if((t=(y=G.n<0)?u:r.call(n,G))!==a)break}catch(t){i=e,c=1,u=t}finally{f=1}}return{value:t,done:y}}}(r,o,i),!0),u}var a={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}t=Object.getPrototypeOf;var c=[][n]?t(t([][n]())):(_regeneratorDefine2(t={},n,function(){return this}),t),u=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(c);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,_regeneratorDefine2(e,o,"GeneratorFunction")),e.prototype=Object.create(u),e}return GeneratorFunction.prototype=GeneratorFunctionPrototype,_regeneratorDefine2(u,"constructor",GeneratorFunctionPrototype),_regeneratorDefine2(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName="GeneratorFunction",_regeneratorDefine2(GeneratorFunctionPrototype,o,"GeneratorFunction"),_regeneratorDefine2(u),_regeneratorDefine2(u,o,"Generator"),_regeneratorDefine2(u,n,function(){return this}),_regeneratorDefine2(u,"toString",function(){return"[object Generator]"}),(_regenerator=function _regenerator(){return{w:i,m:f}})()}function _regeneratorDefine2(e,r,n,t){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}_regeneratorDefine2=function _regeneratorDefine(e,r,n,t){function o(r,n){_regeneratorDefine2(e,r,function(e){return this._invoke(r,n,e)})}r?i?i(e,r,{value:n,enumerable:!t,configurable:!t,writable:!t}):e[r]=n:(o("next",0),o("throw",1),o("return",2))},_regeneratorDefine2(e,r,n,t)}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function _defineProperty(e,r,t){return(r=function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise(function(r,o){var a=n.apply(t,e);function _next(n){asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)})}}function _slicedToArray(r,e){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}(r,e)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var useAuth=function useAuth(){var _useState2=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_0__.useState)({user:null,loading:!0,error:null}),2),authState=_useState2[0],setAuthState=_useState2[1];(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(function(){var auth=(0,_lib_firebaseClient__WEBPACK_IMPORTED_MODULE_2__.Cy)(),unsubscribe=(0,firebase_auth__WEBPACK_IMPORTED_MODULE_1__.hg)(auth,function(user){setAuthState({user,loading:!1,error:null})},function(error){console.error("[useAuth] Auth state change error:",error),setAuthState({user:null,loading:!1,error:error.message})});return function(){return unsubscribe()}},[]);var signIn=function(){var _ref=_asyncToGenerator(_regenerator().m(function _callee(email,password){var auth,userCredential,errorMessage,_t;return _regenerator().w(function(_context){for(;;)switch(_context.p=_context.n){case 0:return _context.p=0,setAuthState(function(prev){return _objectSpread(_objectSpread({},prev),{},{loading:!0,error:null})}),auth=(0,_lib_firebaseClient__WEBPACK_IMPORTED_MODULE_2__.Cy)(),_context.n=1,(0,firebase_auth__WEBPACK_IMPORTED_MODULE_1__.x9)(auth,email,password);case 1:return userCredential=_context.v,setAuthState({user:userCredential.user,loading:!1,error:null}),_context.a(2,{success:!0});case 2:return _context.p=2,_t=_context.v,errorMessage=_t.message||"Sign in failed",setAuthState(function(prev){return _objectSpread(_objectSpread({},prev),{},{loading:!1,error:errorMessage})}),_context.a(2,{success:!1,error:errorMessage})}},_callee,null,[[0,2]])}));return function signIn(_x,_x2){return _ref.apply(this,arguments)}}(),signUp=function(){var _ref2=_asyncToGenerator(_regenerator().m(function _callee2(email,password){var auth,userCredential,errorMessage,_t2;return _regenerator().w(function(_context2){for(;;)switch(_context2.p=_context2.n){case 0:return _context2.p=0,setAuthState(function(prev){return _objectSpread(_objectSpread({},prev),{},{loading:!0,error:null})}),auth=(0,_lib_firebaseClient__WEBPACK_IMPORTED_MODULE_2__.Cy)(),_context2.n=1,(0,firebase_auth__WEBPACK_IMPORTED_MODULE_1__.eJ)(auth,email,password);case 1:return userCredential=_context2.v,setAuthState({user:userCredential.user,loading:!1,error:null}),_context2.a(2,{success:!0});case 2:return _context2.p=2,_t2=_context2.v,errorMessage=_t2.message||"Sign up failed",setAuthState(function(prev){return _objectSpread(_objectSpread({},prev),{},{loading:!1,error:errorMessage})}),_context2.a(2,{success:!1,error:errorMessage})}},_callee2,null,[[0,2]])}));return function signUp(_x3,_x4){return _ref2.apply(this,arguments)}}(),signInWithGoogle=function(){var _ref3=_asyncToGenerator(_regenerator().m(function _callee3(){var auth,provider,userCredential,errorMessage,_t3;return _regenerator().w(function(_context3){for(;;)switch(_context3.p=_context3.n){case 0:return _context3.p=0,setAuthState(function(prev){return _objectSpread(_objectSpread({},prev),{},{loading:!0,error:null})}),auth=(0,_lib_firebaseClient__WEBPACK_IMPORTED_MODULE_2__.Cy)(),provider=new firebase_auth__WEBPACK_IMPORTED_MODULE_1__.HF,_context3.n=1,(0,firebase_auth__WEBPACK_IMPORTED_MODULE_1__.df)(auth,provider);case 1:return userCredential=_context3.v,setAuthState({user:userCredential.user,loading:!1,error:null}),_context3.a(2,{success:!0});case 2:return _context3.p=2,_t3=_context3.v,errorMessage=_t3.message||"Google sign in failed",setAuthState(function(prev){return _objectSpread(_objectSpread({},prev),{},{loading:!1,error:errorMessage})}),_context3.a(2,{success:!1,error:errorMessage})}},_callee3,null,[[0,2]])}));return function signInWithGoogle(){return _ref3.apply(this,arguments)}}(),signOut=function(){var _ref4=_asyncToGenerator(_regenerator().m(function _callee4(){var auth,errorMessage,_t4;return _regenerator().w(function(_context4){for(;;)switch(_context4.p=_context4.n){case 0:return _context4.p=0,setAuthState(function(prev){return _objectSpread(_objectSpread({},prev),{},{loading:!0,error:null})}),auth=(0,_lib_firebaseClient__WEBPACK_IMPORTED_MODULE_2__.Cy)(),_context4.n=1,(0,firebase_auth__WEBPACK_IMPORTED_MODULE_1__.CI)(auth);case 1:return setAuthState({user:null,loading:!1,error:null}),_context4.a(2,{success:!0});case 2:return _context4.p=2,_t4=_context4.v,errorMessage=_t4.message||"Sign out failed",setAuthState(function(prev){return _objectSpread(_objectSpread({},prev),{},{loading:!1,error:errorMessage})}),_context4.a(2,{success:!1,error:errorMessage})}},_callee4,null,[[0,2]])}));return function signOut(){return _ref4.apply(this,arguments)}}();return{user:authState.user,loading:authState.loading,error:authState.error,signIn,signUp,signInWithGoogle,signOut}}},"./lib/firebaseClient.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Cy:()=>getFirebaseAuth,s$:()=>getFirebaseDb,tf:()=>getFirebaseStorage});var _process$env$NEXT_PUB,_process$env$NEXT_PUB2,_process$env$NEXT_PUB3,_process$env$NEXT_PUB4,_process$env$NEXT_PUB5,_process$env$NEXT_PUB6,_process$env$NEXT_PUB7,firebase_app__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/firebase/app/dist/esm/index.esm.js"),firebase_auth__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/firebase/auth/dist/esm/index.esm.js"),firebase_firestore__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/firebase/firestore/dist/esm/index.esm.js"),firebase_storage__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/firebase/storage/dist/esm/index.esm.js"),process=(__webpack_require__("./node_modules/firebase/analytics/dist/esm/index.esm.js"),__webpack_require__("./node_modules/process/browser.js"));function _slicedToArray(r,e){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}(r,e)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var firebaseConfig={apiKey:null!==(_process$env$NEXT_PUB=process.env.NEXT_PUBLIC_FIREBASE_API_KEY)&&void 0!==_process$env$NEXT_PUB?_process$env$NEXT_PUB:"AIzaSyCeJ440MsvYVQbUQY6jzIZ7jhyfNsQhcpE",authDomain:null!==(_process$env$NEXT_PUB2=process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN)&&void 0!==_process$env$NEXT_PUB2?_process$env$NEXT_PUB2:"youthforge-802e6.firebaseapp.com",projectId:null!==(_process$env$NEXT_PUB3=process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID)&&void 0!==_process$env$NEXT_PUB3?_process$env$NEXT_PUB3:"youthforge-802e6",storageBucket:null!==(_process$env$NEXT_PUB4=process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET)&&void 0!==_process$env$NEXT_PUB4?_process$env$NEXT_PUB4:"youthforge-802e6.appspot.com",appId:null!==(_process$env$NEXT_PUB5=process.env.NEXT_PUBLIC_FIREBASE_APP_ID)&&void 0!==_process$env$NEXT_PUB5?_process$env$NEXT_PUB5:"1:463749575901:web:30536f16f78c8443455734",messagingSenderId:null!==(_process$env$NEXT_PUB6=process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID)&&void 0!==_process$env$NEXT_PUB6?_process$env$NEXT_PUB6:"463749575901",measurementId:null!==(_process$env$NEXT_PUB7=process.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID)&&void 0!==_process$env$NEXT_PUB7?_process$env$NEXT_PUB7:"G-3PT163YGK8"};Object.entries(firebaseConfig).filter(function(_ref){return!_slicedToArray(_ref,2)[1]}).map(function(_ref3){return _slicedToArray(_ref3,1)[0]}).length;var cachedApp=null,getFirebaseApp=function getFirebaseApp(){return cachedApp||(cachedApp=(0,firebase_app__WEBPACK_IMPORTED_MODULE_0__.Dk)().length?(0,firebase_app__WEBPACK_IMPORTED_MODULE_0__.Sx)():(0,firebase_app__WEBPACK_IMPORTED_MODULE_0__.Wp)(firebaseConfig))},getFirebaseAuth=function getFirebaseAuth(){return(0,firebase_auth__WEBPACK_IMPORTED_MODULE_1__.xI)(getFirebaseApp())},getFirebaseDb=function getFirebaseDb(){return(0,firebase_firestore__WEBPACK_IMPORTED_MODULE_2__.aU)(getFirebaseApp())},getFirebaseStorage=function getFirebaseStorage(){return(0,firebase_storage__WEBPACK_IMPORTED_MODULE_3__.c7)(getFirebaseApp())}},"./src/config/constants.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$v:()=>FEATURE_FLAGS,D0:()=>UPLOAD_RETRY_BACKOFF_MS,M9:()=>PROJECT_MEDIA_STORAGE_ROOT,Os:()=>COMMENT_PAGE_SIZE,QD:()=>MODERATION_LOG_LIMIT,ee:()=>PROJECT_IMAGE_LIMIT,fD:()=>PROJECT_IMAGE_MAX_BYTES,kF:()=>PROJECT_PAGE_SIZE,mA:()=>UPLOAD_MAX_RETRIES,md:()=>DEFAULT_IMAGE_MAX_DIMENSION,ze:()=>LIKE_COOLDOWN_MS});var _process$env$NEXT_PUB,_process$env$NEXT_PUB2,_process$env$NEXT_PUB3,_process$env$NEXT_PUB4,_process$env$NEXT_PUB5,process=__webpack_require__("./node_modules/process/browser.js"),PROJECT_PAGE_SIZE=12,PROJECT_IMAGE_LIMIT=5,PROJECT_IMAGE_MAX_BYTES=1e6,LIKE_COOLDOWN_MS=1e3,COMMENT_PAGE_SIZE=20,UPLOAD_MAX_RETRIES=3,UPLOAD_RETRY_BACKOFF_MS=700,DEFAULT_IMAGE_MAX_DIMENSION=1920,PROJECT_MEDIA_STORAGE_ROOT="projects",MODERATION_LOG_LIMIT=50,FEATURE_FLAGS={useFirebaseAdapter:"true"===process.env.NEXT_PUBLIC_USE_FIREBASE};_process$env$NEXT_PUB=process.env.NEXT_PUBLIC_FIREBASE_API_KEY,_process$env$NEXT_PUB2=process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,_process$env$NEXT_PUB3=process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,_process$env$NEXT_PUB4=process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,_process$env$NEXT_PUB5=process.env.NEXT_PUBLIC_FIREBASE_APP_ID},"./src/hooks/useProjects.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Lg:()=>useToggleLike,_2:()=>updateProjectDetailEntries,bL:()=>useCreateProject,gU:()=>projectQueryKeys});__webpack_require__("./node_modules/react/index.js");var _tanstack_react_query__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js"),_tanstack_react_query__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@tanstack/react-query/build/modern/useMutation.js"),_src_lib_adapterFactory__WEBPACK_IMPORTED_MODULE_4__=(__webpack_require__("./src/config/constants.ts"),__webpack_require__("./src/lib/adapterFactory.ts"));function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function _defineProperty(e,r,t){return(r=function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _slicedToArray(r,e){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||_unsupportedIterableToArray(r,e)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _toConsumableArray(r){return function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}(r)||function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||_unsupportedIterableToArray(r)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var projectQueryKeys={all:["projects"],lists:function lists(){return[].concat(_toConsumableArray(projectQueryKeys.all),["list"])},list:function list(filters){return[].concat(_toConsumableArray(projectQueryKeys.lists()),[filters])},detail:function detail(idOrSlug){return[].concat(_toConsumableArray(projectQueryKeys.all),["detail",idOrSlug])}},syncDetailKey=function syncDetailKey(queryClient,key,project){queryClient.setQueryData(key,project)},syncProjectDetailInCache=function syncProjectDetailInCache(queryClient,project){syncDetailKey(queryClient,projectQueryKeys.detail(project.id),project),syncDetailKey(queryClient,projectQueryKeys.detail(project.slug),project)},updateProjectDetailEntries=function updateProjectDetailEntries(queryClient,projectId,updater){queryClient.getQueriesData({queryKey:projectQueryKeys.all}).forEach(function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],data=_ref2[1];if(Array.isArray(key)&&function isDetailKey(key){return Array.isArray(key)&&key[0]===projectQueryKeys.all[0]&&"detail"===key[1]}(key)&&data&&data.id===projectId){var updated=updater(data);syncDetailKey(queryClient,key,updated),updated.slug&&key[2]!==updated.slug&&syncDetailKey(queryClient,projectQueryKeys.detail(updated.slug),updated)}})},useCreateProject=function useCreateProject(){var queryClient=(0,_tanstack_react_query__WEBPACK_IMPORTED_MODULE_1__.jE)(),adapter=(0,_src_lib_adapterFactory__WEBPACK_IMPORTED_MODULE_4__.IN)();return(0,_tanstack_react_query__WEBPACK_IMPORTED_MODULE_2__.n)({mutationFn:function mutationFn(values){return adapter.createProject(values)},onSuccess:function onSuccess(project){queryClient.invalidateQueries({queryKey:projectQueryKeys.lists()}),syncProjectDetailInCache(queryClient,project)}})},useToggleLike=function useToggleLike(projectId){var queryClient=(0,_tanstack_react_query__WEBPACK_IMPORTED_MODULE_1__.jE)(),adapter=(0,_src_lib_adapterFactory__WEBPACK_IMPORTED_MODULE_4__.IN)();return(0,_tanstack_react_query__WEBPACK_IMPORTED_MODULE_2__.n)({mutationFn:function mutationFn(_ref4){var userId=_ref4.userId;return adapter.toggleLike(projectId,userId)},onSuccess:function onSuccess(result){updateProjectDetailEntries(queryClient,projectId,function(project){return _objectSpread(_objectSpread({},project),{},{likesCount:result.likesCount,likedByViewer:result.liked})}),queryClient.invalidateQueries({queryKey:projectQueryKeys.lists()})}})}},"./src/lib/adapterFactory.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{IN:()=>getProjectsAdapter,OV:()=>overrideProjectsAdapter,NQ:()=>resetProjectsAdapter});var constants=__webpack_require__("./src/config/constants.ts"),index_browser=__webpack_require__("./node_modules/nanoid/index.browser.js"),index_esm=__webpack_require__("./node_modules/firebase/firestore/dist/esm/index.esm.js"),firebaseClient=__webpack_require__("./lib/firebaseClient.ts"),upload=__webpack_require__("./src/lib/upload.ts");function _slicedToArray(r,e){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}(r,e)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function _regenerator(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var c=n&&n.prototype instanceof Generator?n:Generator,u=Object.create(c.prototype);return _regeneratorDefine2(u,"_invoke",function(r,n,o){var i,c,u,f=0,p=o||[],y=!1,G={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function d(t,r){return i=t,c=0,u=e,G.n=r,a}};function d(r,n){for(c=r,u=n,t=0;!y&&f&&!o&&t<p.length;t++){var o,i=p[t],d=G.p,l=i[2];r>3?(o=l===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=e):i[0]<=d&&((o=r<2&&d<i[1])?(c=0,G.v=n,G.n=i[1]):d<l&&(o=r<3||i[0]>n||n>l)&&(i[4]=r,i[5]=n,G.n=l,c=0))}if(o||r>1)return a;throw y=!0,n}return function(o,p,l){if(f>1)throw TypeError("Generator is already running");for(y&&1===p&&d(p,l),c=p,u=l;(t=c<2?e:u)||!y;){i||(c?c<3?(c>1&&(G.n=-1),d(c,u)):G.n=u:G.v=u);try{if(f=2,i){if(c||(o="next"),t=i[o]){if(!(t=t.call(i,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,c<2&&(c=0)}else 1===c&&(t=i.return)&&t.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=e}else if((t=(y=G.n<0)?u:r.call(n,G))!==a)break}catch(t){i=e,c=1,u=t}finally{f=1}}return{value:t,done:y}}}(r,o,i),!0),u}var a={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}t=Object.getPrototypeOf;var c=[][n]?t(t([][n]())):(_regeneratorDefine2(t={},n,function(){return this}),t),u=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(c);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,_regeneratorDefine2(e,o,"GeneratorFunction")),e.prototype=Object.create(u),e}return GeneratorFunction.prototype=GeneratorFunctionPrototype,_regeneratorDefine2(u,"constructor",GeneratorFunctionPrototype),_regeneratorDefine2(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName="GeneratorFunction",_regeneratorDefine2(GeneratorFunctionPrototype,o,"GeneratorFunction"),_regeneratorDefine2(u),_regeneratorDefine2(u,o,"Generator"),_regeneratorDefine2(u,n,function(){return this}),_regeneratorDefine2(u,"toString",function(){return"[object Generator]"}),(_regenerator=function _regenerator(){return{w:i,m:f}})()}function _regeneratorDefine2(e,r,n,t){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}_regeneratorDefine2=function _regeneratorDefine(e,r,n,t){function o(r,n){_regeneratorDefine2(e,r,function(e){return this._invoke(r,n,e)})}r?i?i(e,r,{value:n,enumerable:!t,configurable:!t,writable:!t}):e[r]=n:(o("next",0),o("throw",1),o("return",2))},_regeneratorDefine2(e,r,n,t)}function asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise(function(r,o){var a=n.apply(t,e);function _next(n){asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)})}}var projectsCollection=function projectsCollection(db){return(0,index_esm.rJ)(db,"projects")},projectDoc=function projectDoc(db,projectId){return(0,index_esm.H9)(projectsCollection(db),projectId)},likeDoc=function likeDoc(db,projectId,userId){return(0,index_esm.H9)(function likesCollection(db,projectId){return(0,index_esm.rJ)(projectDoc(db,projectId),"likes")}(db,projectId),userId)},commentsCollectionRef=function commentsCollectionRef(db,projectId){return(0,index_esm.rJ)(projectDoc(db,projectId),"comments")},toIso=function toIso(value){return value instanceof index_esm.Dc?value.toDate().toISOString():"string"==typeof value?value:(new Date).toISOString()},docToProject=function docToProject(snap){var _data$tags,_data$media,_data$likesCount,_data$commentsCount,_data$moderationLogs;if(!snap||!snap.exists())return null;var data=snap.data();return{id:snap.id,slug:data.slug,title:data.title,summary:data.summary,description:data.description,tags:null!==(_data$tags=data.tags)&&void 0!==_data$tags?_data$tags:[],repoUrl:data.repoUrl,demoUrl:data.demoUrl,visibility:data.visibility,isFeatured:Boolean(data.isFeatured),owner:data.owner,media:null!==(_data$media=data.media)&&void 0!==_data$media?_data$media:[],likesCount:null!==(_data$likesCount=data.likesCount)&&void 0!==_data$likesCount?_data$likesCount:0,commentsCount:null!==(_data$commentsCount=data.commentsCount)&&void 0!==_data$commentsCount?_data$commentsCount:0,likedByViewer:data.likedByViewer,createdAt:toIso(data.createdAt),updatedAt:data.updatedAt?toIso(data.updatedAt):void 0,deletedAt:data.deletedAt?toIso(data.deletedAt):void 0,moderationLogs:null!==(_data$moderationLogs=data.moderationLogs)&&void 0!==_data$moderationLogs?_data$moderationLogs:[]}},sanitizeModerationLogs=function sanitizeModerationLogs(logs){return(null!=logs?logs:[]).slice(0,constants.QD)},filesToMedia=function(){var _ref=_asyncToGenerator(_regenerator().m(function _callee(projectId,files,options){var safeFiles,uploads;return _regenerator().w(function(_context){for(;;)switch(_context.n){case 0:return safeFiles=files.slice(0,constants.ee),_context.n=1,Promise.all(safeFiles.map(function(file){return(0,upload.B)(projectId,file,{onProgress:null==options?void 0:options.onProgress})}));case 1:return uploads=_context.v,_context.a(2,uploads.map(function(upload,index){var _safeFiles$index$name,_safeFiles$index;return{id:"media_".concat((0,index_browser.Ak)(8),"_").concat(index),kind:"image",alt:null!==(_safeFiles$index$name=null===(_safeFiles$index=safeFiles[index])||void 0===_safeFiles$index?void 0:_safeFiles$index.name)&&void 0!==_safeFiles$index$name?_safeFiles$index$name:"Project media",storagePath:upload.storagePath,downloadUrl:upload.downloadUrl,width:upload.width,height:upload.height,size:upload.size,contentType:upload.contentType,createdAt:(new Date).toISOString()}}))}},_callee)}));return function filesToMedia(_x,_x2,_x3){return _ref.apply(this,arguments)}}(),getProjectSnapshot=function(){var _ref2=_asyncToGenerator(_regenerator().m(function _callee2(db,idOrSlug){var directSnap,slugQuery,match;return _regenerator().w(function(_context2){for(;;)switch(_context2.n){case 0:return _context2.n=1,(0,index_esm.x7)(projectDoc(db,idOrSlug));case 1:if(!(directSnap=_context2.v).exists()){_context2.n=2;break}return _context2.a(2,directSnap);case 2:return slugQuery=(0,index_esm.P)(projectsCollection(db),(0,index_esm._M)("slug","==",idOrSlug),(0,index_esm.AB)(1)),_context2.n=3,(0,index_esm.GG)(slugQuery);case 3:return match=_context2.v,_context2.a(2,match.docs[0])}},_callee2)}));return function getProjectSnapshot(_x4,_x5){return _ref2.apply(this,arguments)}}(),projectListener=function projectListener(refOrQuery,cb){return(0,index_esm.aQ)(refOrQuery,function(snapshot){if("docs"in snapshot){var docSnap=snapshot.docs[0];cb(docToProject(docSnap))}else cb(docToProject(snapshot))})},projectsQuery=function(){var _ref3=_asyncToGenerator(_regenerator().m(function _callee3(db,params){var _params$limit,constraints,visibleStates,sortField,pageSize,cursorSnap;return _regenerator().w(function(_context3){for(;;)switch(_context3.n){case 0:if(constraints=[],params.slug&&constraints.push((0,index_esm._M)("slug","==",params.slug)),params.slug||(visibleStates=["public","unlisted"],constraints.push((0,index_esm._M)("visibility","in",visibleStates))),(params.featuredOnly||"featured"===params.sort)&&constraints.push((0,index_esm._M)("isFeatured","==",!0)),params.tag&&constraints.push((0,index_esm._M)("tags","array-contains",params.tag)),sortField="popular"===params.sort?"likesCount":"createdAt",constraints.push((0,index_esm.My)(sortField,"desc")),"createdAt"!==sortField&&constraints.push((0,index_esm.My)("createdAt","desc")),pageSize=Math.min(null!==(_params$limit=params.limit)&&void 0!==_params$limit?_params$limit:constants.kF,2*constants.kF),constraints.push((0,index_esm.AB)(pageSize)),!params.cursor){_context3.n=2;break}return _context3.n=1,(0,index_esm.x7)(projectDoc(db,params.cursor));case 1:(cursorSnap=_context3.v).exists()&&constraints.push((0,index_esm.HM)(cursorSnap));case 2:return _context3.a(2,index_esm.P.apply(void 0,[projectsCollection(db)].concat(constraints)))}},_callee3)}));return function projectsQuery(_x6,_x7){return _ref3.apply(this,arguments)}}(),firebaseAdapter={createProject:function createProject(input){return _asyncToGenerator(_regenerator().m(function _callee4(){var db,ref,moderationLogs,payload,docRef,snapshot,record;return _regenerator().w(function(_context4){for(;;)switch(_context4.n){case 0:if(db=(0,firebaseClient.s$)(),ref=projectsCollection(db),moderationLogs=sanitizeModerationLogs(input.moderationLogs),payload={slug:input.slug,title:input.title,summary:input.summary,description:input.description,tags:input.tags,repoUrl:input.repoUrl,demoUrl:input.demoUrl,visibility:input.visibility,isFeatured:Boolean(input.isFeatured),owner:input.owner,media:input.media,likesCount:0,commentsCount:0,createdAt:(0,index_esm.O5)(),updatedAt:(0,index_esm.O5)(),moderationLogs},!input.projectId){_context4.n=2;break}return docRef=(0,index_esm.H9)(ref,input.projectId),_context4.n=1,(0,index_esm.BN)(docRef,payload);case 1:_context4.n=4;break;case 2:return _context4.n=3,(0,index_esm.gS)(ref,payload);case 3:docRef=_context4.v;case 4:return _context4.n=5,(0,index_esm.x7)(docRef);case 5:if(snapshot=_context4.v,record=docToProject(snapshot)){_context4.n=6;break}throw new Error("Failed to create project");case 6:return _context4.a(2,record)}},_callee4)}))()},updateProject:function updateProject(input){return _asyncToGenerator(_regenerator().m(function _callee6(){var db,ref,snapshot,record;return _regenerator().w(function(_context6){for(;;)switch(_context6.n){case 0:return db=(0,firebaseClient.s$)(),ref=projectDoc(db,input.projectId),_context6.n=1,(0,index_esm.c4)(db,function(){var _ref4=_asyncToGenerator(_regenerator().m(function _callee5(tx){var _input$slug,_input$title,_input$summary,_input$description,_input$tags,_input$repoUrl,_input$demoUrl,_input$visibility,_input$media,snap,data,nextSlug,_slugMatch$docs$,slugMatch,updates;return _regenerator().w(function(_context5){for(;;)switch(_context5.n){case 0:return _context5.n=1,tx.get(ref);case 1:if((snap=_context5.v).exists()){_context5.n=2;break}throw new Error("Project not found");case 2:if(data=snap.data(),(nextSlug=null!==(_input$slug=input.slug)&&void 0!==_input$slug?_input$slug:data.slug)===data.slug){_context5.n=4;break}return _context5.n=3,(0,index_esm.GG)((0,index_esm.P)(projectsCollection(db),(0,index_esm._M)("slug","==",nextSlug),(0,index_esm.AB)(1)));case 3:if((slugMatch=_context5.v).empty||(null===(_slugMatch$docs$=slugMatch.docs[0])||void 0===_slugMatch$docs$?void 0:_slugMatch$docs$.id)===snap.id){_context5.n=4;break}throw new Error("Slug already in use");case 4:updates={slug:nextSlug,title:null!==(_input$title=input.title)&&void 0!==_input$title?_input$title:data.title,summary:null!==(_input$summary=input.summary)&&void 0!==_input$summary?_input$summary:data.summary,description:null!==(_input$description=input.description)&&void 0!==_input$description?_input$description:data.description,tags:null!==(_input$tags=input.tags)&&void 0!==_input$tags?_input$tags:data.tags,repoUrl:null!==(_input$repoUrl=input.repoUrl)&&void 0!==_input$repoUrl?_input$repoUrl:data.repoUrl,demoUrl:null!==(_input$demoUrl=input.demoUrl)&&void 0!==_input$demoUrl?_input$demoUrl:data.demoUrl,visibility:null!==(_input$visibility=input.visibility)&&void 0!==_input$visibility?_input$visibility:data.visibility,media:null!==(_input$media=input.media)&&void 0!==_input$media?_input$media:data.media,isFeatured:"boolean"==typeof input.isFeatured?input.isFeatured:data.isFeatured,moderationLogs:input.moderationLogs?sanitizeModerationLogs(input.moderationLogs):data.moderationLogs,updatedAt:(0,index_esm.O5)()},tx.update(ref,updates);case 5:return _context5.a(2)}},_callee5)}));return function(_x8){return _ref4.apply(this,arguments)}}());case 1:return _context6.n=2,(0,index_esm.x7)(ref);case 2:if(snapshot=_context6.v,record=docToProject(snapshot)){_context6.n=3;break}throw new Error("Project not found after update");case 3:return _context6.a(2,record)}},_callee6)}))()},deleteProject:function deleteProject(projectId){return _asyncToGenerator(_regenerator().m(function _callee7(){var db;return _regenerator().w(function(_context7){for(;;)switch(_context7.n){case 0:return db=(0,firebaseClient.s$)(),_context7.n=1,(0,index_esm.mZ)(projectDoc(db,projectId),{visibility:"deleted",deletedAt:(0,index_esm.O5)(),updatedAt:(0,index_esm.O5)()});case 1:return _context7.a(2)}},_callee7)}))()},uploadProjectMedia:function uploadProjectMedia(projectId,files,options){return _asyncToGenerator(_regenerator().m(function _callee8(){return _regenerator().w(function(_context8){for(;;)if(0===_context8.n)return _context8.a(2,filesToMedia(projectId,files,options))},_callee8)}))()},fetchProjectById:function fetchProjectById(idOrSlug){return _asyncToGenerator(_regenerator().m(function _callee9(){var db,snapshot;return _regenerator().w(function(_context9){for(;;)switch(_context9.n){case 0:return db=(0,firebaseClient.s$)(),_context9.n=1,getProjectSnapshot(db,idOrSlug);case 1:return snapshot=_context9.v,_context9.a(2,docToProject(snapshot))}},_callee9)}))()},listenProject:function listenProject(idOrSlug,cb){var db=(0,firebaseClient.s$)(),cancelled=!1,activeUnsub=null;return _asyncToGenerator(_regenerator().m(function _callee0(){var directRef,snap,slugQuery;return _regenerator().w(function(_context0){for(;;)switch(_context0.n){case 0:return directRef=projectDoc(db,idOrSlug),_context0.n=1,(0,index_esm.x7)(directRef);case 1:if(snap=_context0.v,!cancelled){_context0.n=2;break}return _context0.a(2);case 2:if(!snap.exists()){_context0.n=3;break}return activeUnsub=projectListener(directRef,cb),_context0.a(2);case 3:slugQuery=(0,index_esm.P)(projectsCollection(db),(0,index_esm._M)("slug","==",idOrSlug),(0,index_esm.AB)(1)),activeUnsub=projectListener(slugQuery,cb);case 4:return _context0.a(2)}},_callee0)}))(),function cleanup(){var _activeUnsub;cancelled=!0,null===(_activeUnsub=activeUnsub)||void 0===_activeUnsub||_activeUnsub()}},fetchProjects:function fetchProjects(params){var _this=this;return _asyncToGenerator(_regenerator().m(function _callee1(){var _params$limit2,_snapshot$docs,db,match,q,snapshot,projects,pageSize,nextCursor;return _regenerator().w(function(_context1){for(;;)switch(_context1.n){case 0:if(db=(0,firebaseClient.s$)(),!params.slug){_context1.n=2;break}return _context1.n=1,_this.fetchProjectById(params.slug);case 1:return match=_context1.v,_context1.a(2,{projects:match?[match]:[],nextCursor:void 0});case 2:return _context1.n=3,projectsQuery(db,params);case 3:return q=_context1.v,_context1.n=4,(0,index_esm.GG)(q);case 4:return snapshot=_context1.v,projects=snapshot.docs.map(function(docSnap){return docToProject(docSnap)}).filter(function(record){return Boolean(record)}),pageSize=Math.min(null!==(_params$limit2=params.limit)&&void 0!==_params$limit2?_params$limit2:constants.kF,2*constants.kF),nextCursor=snapshot.size===pageSize?null===(_snapshot$docs=snapshot.docs[snapshot.docs.length-1])||void 0===_snapshot$docs?void 0:_snapshot$docs.id:void 0,_context1.a(2,{projects,nextCursor})}},_callee1)}))()},createComment:function createComment(projectId,input){return _asyncToGenerator(_regenerator().m(function _callee10(){var db,commentsRef,newComment,commentDoc,stored;return _regenerator().w(function(_context10){for(;;)switch(_context10.n){case 0:return db=(0,firebaseClient.s$)(),commentsRef=commentsCollectionRef(db,projectId),newComment={body:input.body,author:input.author,parentId:input.parentId,createdAt:(0,index_esm.O5)()},_context10.n=1,(0,index_esm.gS)(commentsRef,newComment);case 1:return commentDoc=_context10.v,_context10.n=2,(0,index_esm.mZ)(projectDoc(db,projectId),{commentsCount:(0,index_esm.GV)(1),updatedAt:(0,index_esm.O5)()});case 2:return _context10.n=3,(0,index_esm.x7)(commentDoc);case 3:return stored=_context10.v,_context10.a(2,{id:stored.id,projectId,body:input.body,author:input.author,parentId:input.parentId,createdAt:stored.get("createdAt")instanceof index_esm.Dc?stored.get("createdAt").toDate().toISOString():(new Date).toISOString()})}},_callee10)}))()},listenComments:function listenComments(projectId,cb,cursor){var q=function commentQuery(db,projectId,cursor){var base=[(0,index_esm.My)("createdAt","desc"),(0,index_esm.AB)(constants.Os)];if(cursor){var cursorDate=new Date(cursor);Number.isNaN(cursorDate.getTime())||base.push((0,index_esm.HM)(index_esm.Dc.fromMillis(cursorDate.getTime())))}return index_esm.P.apply(void 0,[commentsCollectionRef(db,projectId)].concat(base))}((0,firebaseClient.s$)(),projectId,cursor);return(0,index_esm.aQ)(q,function(snapshot){var comments=snapshot.docs.map(function(docSnap){return function commentSnapshotToRecord(snap){var _snap$ref$parent$pare,_snap$ref$parent$pare2,data=snap.data();return{id:snap.id,projectId:null!==(_snap$ref$parent$pare=null===(_snap$ref$parent$pare2=snap.ref.parent.parent)||void 0===_snap$ref$parent$pare2?void 0:_snap$ref$parent$pare2.id)&&void 0!==_snap$ref$parent$pare?_snap$ref$parent$pare:"",body:data.body,author:data.author,parentId:data.parentId,createdAt:toIso(data.createdAt),updatedAt:data.updatedAt?toIso(data.updatedAt):void 0}}(docSnap)}),tail=snapshot.docs[snapshot.docs.length-1],nextCursor=snapshot.size===constants.Os&&tail?toIso(tail.get("createdAt")):void 0;cb({comments,nextCursor})})},toggleLike:function toggleLike(projectId,userId){return _asyncToGenerator(_regenerator().m(function _callee12(){var db;return _regenerator().w(function(_context12){for(;;)if(0===_context12.n)return db=(0,firebaseClient.s$)(),_context12.a(2,(0,index_esm.c4)(db,function(){var _ref6=_asyncToGenerator(_regenerator().m(function _callee11(tx){var _likesCount,projectRef,likeRef,_yield$Promise$all,_yield$Promise$all2,projectSnap,likeSnap,currentCount,nextCount;return _regenerator().w(function(_context11){for(;;)switch(_context11.n){case 0:return projectRef=projectDoc(db,projectId),likeRef=likeDoc(db,projectId,userId),_context11.n=1,Promise.all([tx.get(projectRef),tx.get(likeRef)]);case 1:if(_yield$Promise$all=_context11.v,_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2),projectSnap=_yield$Promise$all2[0],likeSnap=_yield$Promise$all2[1],projectSnap.exists()){_context11.n=2;break}throw new Error("Project not found");case 2:if(currentCount=null!==(_likesCount=projectSnap.data().likesCount)&&void 0!==_likesCount?_likesCount:0,nextCount=currentCount,!likeSnap.exists()){_context11.n=3;break}return tx.delete(likeRef),nextCount=Math.max(0,currentCount-1),tx.update(projectRef,{likesCount:nextCount,updatedAt:(0,index_esm.O5)()}),_context11.a(2,{liked:!1,likesCount:nextCount});case 3:return tx.set(likeRef,{createdAt:(0,index_esm.O5)()}),nextCount=currentCount+1,tx.update(projectRef,{likesCount:nextCount,updatedAt:(0,index_esm.O5)()}),_context11.a(2,{liked:!0,likesCount:nextCount})}},_callee11)}));return function(_x9){return _ref6.apply(this,arguments)}}()))},_callee12)}))()}},mockAdapter=__webpack_require__("./src/lib/mockAdapter.ts"),cachedAdapter=null,getProjectsAdapter=function getProjectsAdapter(){return cachedAdapter||(cachedAdapter=constants.$v.useFirebaseAdapter?firebaseAdapter:mockAdapter.C)},overrideProjectsAdapter=function overrideProjectsAdapter(adapter){cachedAdapter=adapter},resetProjectsAdapter=function resetProjectsAdapter(){cachedAdapter=null}},"./src/lib/mockAdapter.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{C:()=>mockAdapter});var nanoid__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/nanoid/index.browser.js"),_src_config_constants__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/config/constants.ts");function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function _defineProperty(e,r,t){return(r=function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _regenerator(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var c=n&&n.prototype instanceof Generator?n:Generator,u=Object.create(c.prototype);return _regeneratorDefine2(u,"_invoke",function(r,n,o){var i,c,u,f=0,p=o||[],y=!1,G={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function d(t,r){return i=t,c=0,u=e,G.n=r,a}};function d(r,n){for(c=r,u=n,t=0;!y&&f&&!o&&t<p.length;t++){var o,i=p[t],d=G.p,l=i[2];r>3?(o=l===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=e):i[0]<=d&&((o=r<2&&d<i[1])?(c=0,G.v=n,G.n=i[1]):d<l&&(o=r<3||i[0]>n||n>l)&&(i[4]=r,i[5]=n,G.n=l,c=0))}if(o||r>1)return a;throw y=!0,n}return function(o,p,l){if(f>1)throw TypeError("Generator is already running");for(y&&1===p&&d(p,l),c=p,u=l;(t=c<2?e:u)||!y;){i||(c?c<3?(c>1&&(G.n=-1),d(c,u)):G.n=u:G.v=u);try{if(f=2,i){if(c||(o="next"),t=i[o]){if(!(t=t.call(i,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,c<2&&(c=0)}else 1===c&&(t=i.return)&&t.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=e}else if((t=(y=G.n<0)?u:r.call(n,G))!==a)break}catch(t){i=e,c=1,u=t}finally{f=1}}return{value:t,done:y}}}(r,o,i),!0),u}var a={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}t=Object.getPrototypeOf;var c=[][n]?t(t([][n]())):(_regeneratorDefine2(t={},n,function(){return this}),t),u=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(c);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,_regeneratorDefine2(e,o,"GeneratorFunction")),e.prototype=Object.create(u),e}return GeneratorFunction.prototype=GeneratorFunctionPrototype,_regeneratorDefine2(u,"constructor",GeneratorFunctionPrototype),_regeneratorDefine2(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName="GeneratorFunction",_regeneratorDefine2(GeneratorFunctionPrototype,o,"GeneratorFunction"),_regeneratorDefine2(u),_regeneratorDefine2(u,o,"Generator"),_regeneratorDefine2(u,n,function(){return this}),_regeneratorDefine2(u,"toString",function(){return"[object Generator]"}),(_regenerator=function _regenerator(){return{w:i,m:f}})()}function _regeneratorDefine2(e,r,n,t){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}_regeneratorDefine2=function _regeneratorDefine(e,r,n,t){function o(r,n){_regeneratorDefine2(e,r,function(e){return this._invoke(r,n,e)})}r?i?i(e,r,{value:n,enumerable:!t,configurable:!t,writable:!t}):e[r]=n:(o("next",0),o("throw",1),o("return",2))},_regeneratorDefine2(e,r,n,t)}function asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise(function(r,o){var a=n.apply(t,e);function _next(n){asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)})}}function _toConsumableArray(r){return function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}(r)||function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||_unsupportedIterableToArray(r)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _slicedToArray(r,e){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||_unsupportedIterableToArray(r,e)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var projectStore=new Map,slugIndex=new Map,commentsStore=new Map,likesStore=new Map,projectListeners=new Map,slugListeners=new Map,commentListeners=new Map,nowIso=function nowIso(){return(new Date).toISOString()};function getProjectId(value){if(projectStore.has(value))return value;var id=slugIndex.get(value);return null!=id?id:null}function buildCommentPage(projectId,cursor){var _commentsStore$get,_pageComments,comments=_toConsumableArray(null!==(_commentsStore$get=commentsStore.get(projectId))&&void 0!==_commentsStore$get?_commentsStore$get:[]).sort(function(a,b){return b.createdAt.localeCompare(a.createdAt)}),startIndex=0;if(cursor){var cursorIndex=comments.findIndex(function(c){return c.createdAt===cursor||c.id===cursor});startIndex=cursorIndex>=0?cursorIndex+1:0}var pageComments=comments.slice(startIndex,startIndex+_src_config_constants__WEBPACK_IMPORTED_MODULE_1__.Os);return{comments:pageComments,nextCursor:pageComments.length===_src_config_constants__WEBPACK_IMPORTED_MODULE_1__.Os?null===(_pageComments=pageComments[pageComments.length-1])||void 0===_pageComments?void 0:_pageComments.createdAt:void 0}}function emitComments(projectId){var listeners=commentListeners.get(projectId);listeners&&listeners.forEach(function(cursor,listener){listener(buildCommentPage(projectId,cursor))})}function paginateProjects(query){var _query$limit,_query$sort,limit=null!==(_query$limit=query.limit)&&void 0!==_query$limit?_query$limit:_src_config_constants__WEBPACK_IMPORTED_MODULE_1__.kF,projects=Array.from(projectStore.values()).filter(function(p){return"deleted"!==p.visibility});if(query.slug&&(projects=projects.filter(function(p){return p.slug===query.slug})),(query.featuredOnly||"featured"===query.sort)&&(projects=projects.filter(function(p){return p.isFeatured})),query.tag){var tag=query.tag;projects=projects.filter(function(p){return p.tags.includes(tag)})}var sorter={new:function _new(a,b){return b.createdAt.localeCompare(a.createdAt)},popular:function popular(a,b){return b.likesCount-a.likesCount},featured:function featured(a,b){return Number(b.isFeatured)-Number(a.isFeatured)}}[null!==(_query$sort=query.sort)&&void 0!==_query$sort?_query$sort:"new"];if(projects.sort(sorter),query.cursor){var cursorIndex=projects.findIndex(function(p){return p.id===query.cursor});cursorIndex>=0&&(projects=projects.slice(cursorIndex+1))}var page=projects.slice(0,limit);return{projects:page,nextCursor:page.length===limit?page[page.length-1].id:void 0}}function createMediaRecord(file){var url="undefined"!=typeof window?URL.createObjectURL(file):"mock://".concat(file.name);return{id:"media_".concat((0,nanoid__WEBPACK_IMPORTED_MODULE_0__.Ak)(8)),kind:"image",alt:file.name,storagePath:"mock/".concat(file.name),downloadUrl:url,width:0,height:0,size:file.size,contentType:file.type||"image/jpeg",createdAt:nowIso()}}function upsertProject(record){projectStore.set(record.id,record),slugIndex.set(record.slug,record.id),function emitProject(projectId){var _projectStore$get,_projectListeners$get,_Array$from$find,project=null!==(_projectStore$get=projectStore.get(projectId))&&void 0!==_projectStore$get?_projectStore$get:null;null===(_projectListeners$get=projectListeners.get(projectId))||void 0===_projectListeners$get||_projectListeners$get.forEach(function(listener){return listener(project)});var _slugListeners$get,slug=null===(_Array$from$find=Array.from(slugIndex.entries()).find(function(_ref){return _slicedToArray(_ref,2)[1]===projectId}))||void 0===_Array$from$find?void 0:_Array$from$find[0];slug&&(null===(_slugListeners$get=slugListeners.get(slug))||void 0===_slugListeners$get||_slugListeners$get.forEach(function(listener){return listener(project)}))}(record.id)}!function seedProjects(){if(!(projectStore.size>0)){[{title:"AI-Powered Study Assistant",summary:"Personalized study plans using ML.",description:"A mock description for the AI study project.",tags:["AI/ML","Next.js","Firebase"],owner:{id:"d1",displayName:"Sarah Chen",avatarUrl:"https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=64&h=64&fit=crop"}},{title:"Real-time Collaboration Editor",summary:"Collaborative document editing with CRDT-like syncing.",description:"Real-time editor sample project.",tags:["Collaboration","React","WebSockets"],owner:{id:"d2",displayName:"Marcus Johnson",avatarUrl:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=64&h=64&fit=crop"}},{title:"Mobile Health Tracker",summary:"Cross-platform lifestyle tracker.",description:"Health tracker sample project.",tags:["Mobile","Flutter"],owner:{id:"d3",displayName:"Priya Patel",avatarUrl:"https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=64&h=64&fit=crop"}}].forEach(function(seed){var id="proj_".concat((0,nanoid__WEBPACK_IMPORTED_MODULE_0__.Ak)(10)),slug=seed.title.toLowerCase().replace(/[^a-z0-9]+/g,"-"),project={id,slug,title:seed.title,summary:seed.summary,description:seed.description,tags:seed.tags,repoUrl:"https://github.com/youthforge/demo",demoUrl:"https://demo.youthforge.dev",visibility:"public",isFeatured:!0,owner:seed.owner,media:[{id:"media_".concat((0,nanoid__WEBPACK_IMPORTED_MODULE_0__.Ak)(6)),kind:"image",alt:"".concat(seed.title," preview"),storagePath:"projects/".concat(id,"/media/sample.jpg"),downloadUrl:"https://images.unsplash.com/photo-1503023345310-bd7c1de61c7d?w=1200&auto=format&fit=crop",width:1600,height:900,size:35e4,contentType:"image/jpeg",createdAt:nowIso()}],likesCount:Math.floor(50*Math.random())+5,commentsCount:1,likedByViewer:!1,createdAt:nowIso(),updatedAt:nowIso(),moderationLogs:[]};projectStore.set(id,project),slugIndex.set(slug,id),commentsStore.set(id,[{id:"c_".concat((0,nanoid__WEBPACK_IMPORTED_MODULE_0__.Ak)(8)),projectId:id,body:"Excited to follow this build! ",author:seed.owner,createdAt:nowIso()}]),likesStore.set(id,new Set)})}}();var mockAdapter={createProject:function createProject(input){return _asyncToGenerator(_regenerator().m(function _callee(){var _input$projectId,_input$isFeatured,_input$moderationLogs,id,slug,now,record;return _regenerator().w(function(_context){for(;;)switch(_context.n){case 0:if(id=null!==(_input$projectId=input.projectId)&&void 0!==_input$projectId?_input$projectId:"proj_".concat((0,nanoid__WEBPACK_IMPORTED_MODULE_0__.Ak)(12)),slug=input.slug,now=nowIso(),!slugIndex.has(slug)){_context.n=1;break}throw new Error("Slug already exists");case 1:if(!(input.media.length>_src_config_constants__WEBPACK_IMPORTED_MODULE_1__.ee)){_context.n=2;break}throw new Error("Projects support up to ".concat(_src_config_constants__WEBPACK_IMPORTED_MODULE_1__.ee," images."));case 2:return upsertProject(record={id,slug,title:input.title,summary:input.summary,description:input.description,tags:input.tags,repoUrl:input.repoUrl,demoUrl:input.demoUrl,visibility:input.visibility,isFeatured:null!==(_input$isFeatured=input.isFeatured)&&void 0!==_input$isFeatured&&_input$isFeatured,owner:input.owner,media:input.media,likesCount:0,commentsCount:0,likedByViewer:!1,createdAt:now,updatedAt:now,moderationLogs:(null!==(_input$moderationLogs=input.moderationLogs)&&void 0!==_input$moderationLogs?_input$moderationLogs:[]).slice(0,_src_config_constants__WEBPACK_IMPORTED_MODULE_1__.QD)}),commentsStore.set(id,[]),likesStore.set(id,new Set),_context.a(2,record)}},_callee)}))()},updateProject:function updateProject(input){return _asyncToGenerator(_regenerator().m(function _callee2(){var _input$slug,_input$title,_input$summary,_input$description,_input$tags,_input$repoUrl,_input$demoUrl,_input$media,_input$visibility,project,updates;return _regenerator().w(function(_context2){for(;;)switch(_context2.n){case 0:if(project=projectStore.get(input.projectId)){_context2.n=1;break}throw new Error("Project not found");case 1:if((updates=_objectSpread(_objectSpread(_objectSpread({},project),input),{},{slug:null!==(_input$slug=input.slug)&&void 0!==_input$slug?_input$slug:project.slug,title:null!==(_input$title=input.title)&&void 0!==_input$title?_input$title:project.title,summary:null!==(_input$summary=input.summary)&&void 0!==_input$summary?_input$summary:project.summary,description:null!==(_input$description=input.description)&&void 0!==_input$description?_input$description:project.description,tags:null!==(_input$tags=input.tags)&&void 0!==_input$tags?_input$tags:project.tags,repoUrl:null!==(_input$repoUrl=input.repoUrl)&&void 0!==_input$repoUrl?_input$repoUrl:project.repoUrl,demoUrl:null!==(_input$demoUrl=input.demoUrl)&&void 0!==_input$demoUrl?_input$demoUrl:project.demoUrl,media:null!==(_input$media=input.media)&&void 0!==_input$media?_input$media:project.media,visibility:null!==(_input$visibility=input.visibility)&&void 0!==_input$visibility?_input$visibility:project.visibility,updatedAt:nowIso(),moderationLogs:input.moderationLogs?input.moderationLogs.slice(0,_src_config_constants__WEBPACK_IMPORTED_MODULE_1__.QD):project.moderationLogs})).slug===project.slug){_context2.n=3;break}if(!slugIndex.has(updates.slug)){_context2.n=2;break}throw new Error("Slug already exists");case 2:slugIndex.delete(project.slug),slugIndex.set(updates.slug,updates.id);case 3:return upsertProject(updates),_context2.a(2,updates)}},_callee2)}))()},deleteProject:function deleteProject(projectId){return _asyncToGenerator(_regenerator().m(function _callee3(){var _project$moderationLo,project;return _regenerator().w(function(_context3){for(;;)switch(_context3.n){case 0:if(project=projectStore.get(projectId)){_context3.n=1;break}throw new Error("Project not found");case 1:project.visibility="deleted",project.deletedAt=nowIso(),project.updatedAt=project.deletedAt,project.moderationLogs=[{id:"mod_".concat((0,nanoid__WEBPACK_IMPORTED_MODULE_0__.Ak)(8)),actorId:"system",action:"soft-delete",reason:"Soft delete from mock adapter",createdAt:project.deletedAt}].concat(_toConsumableArray(null!==(_project$moderationLo=project.moderationLogs)&&void 0!==_project$moderationLo?_project$moderationLo:[])).slice(0,_src_config_constants__WEBPACK_IMPORTED_MODULE_1__.QD),upsertProject(project);case 2:return _context3.a(2)}},_callee3)}))()},uploadProjectMedia:function uploadProjectMedia(projectId,files,options){return _asyncToGenerator(_regenerator().m(function _callee4(){var safeFiles;return _regenerator().w(function(_context4){for(;;)if(0===_context4.n)return safeFiles=files.slice(0,_src_config_constants__WEBPACK_IMPORTED_MODULE_1__.ee),_context4.a(2,safeFiles.map(function(file,index){var _options$onProgress;return null==options||null===(_options$onProgress=options.onProgress)||void 0===_options$onProgress||_options$onProgress.call(options,{fileName:file.name,progress:100}),createMediaRecord(file instanceof File?file:new File([file],"upload-".concat(index)))}))},_callee4)}))()},fetchProjectById:function fetchProjectById(idOrSlug){return _asyncToGenerator(_regenerator().m(function _callee5(){var _projectStore$get2,id;return _regenerator().w(function(_context5){for(;;)switch(_context5.n){case 0:if(id=getProjectId(idOrSlug)){_context5.n=1;break}return _context5.a(2,null);case 1:return _context5.a(2,null!==(_projectStore$get2=projectStore.get(id))&&void 0!==_projectStore$get2?_projectStore$get2:null)}},_callee5)}))()},listenProject:function listenProject(idOrSlug,cb){var _map$get,id=getProjectId(idOrSlug),key=null!=id?id:idOrSlug,map=id?projectListeners:slugListeners,listeners=null!==(_map$get=map.get(key))&&void 0!==_map$get?_map$get:new Set;return listeners.add(cb),map.set(key,listeners),Promise.resolve().then(function(){var _projectStore$get3,_projectStore$get4,_slugIndex$get;return cb(id?null!==(_projectStore$get3=projectStore.get(id))&&void 0!==_projectStore$get3?_projectStore$get3:null:null!==(_projectStore$get4=projectStore.get(null!==(_slugIndex$get=slugIndex.get(idOrSlug))&&void 0!==_slugIndex$get?_slugIndex$get:""))&&void 0!==_projectStore$get4?_projectStore$get4:null)}),function(){var current=map.get(key);current&&(current.delete(cb),0===current.size&&map.delete(key))}},fetchProjects:function fetchProjects(query){return _asyncToGenerator(_regenerator().m(function _callee6(){return _regenerator().w(function(_context6){for(;;)if(0===_context6.n)return _context6.a(2,paginateProjects(query))},_callee6)}))()},createComment:function createComment(projectId,input){return _asyncToGenerator(_regenerator().m(function _callee7(){var _commentsStore$get2,project,newComment,comments;return _regenerator().w(function(_context7){for(;;)switch(_context7.n){case 0:if(project=projectStore.get(projectId)){_context7.n=1;break}throw new Error("Project not found");case 1:return newComment={id:"comment_".concat((0,nanoid__WEBPACK_IMPORTED_MODULE_0__.Ak)(10)),projectId,body:input.body,author:input.author,parentId:input.parentId,createdAt:nowIso()},comments=null!==(_commentsStore$get2=commentsStore.get(projectId))&&void 0!==_commentsStore$get2?_commentsStore$get2:[],commentsStore.set(projectId,[newComment].concat(_toConsumableArray(comments))),project.commentsCount+=1,upsertProject(project),emitComments(projectId),_context7.a(2,newComment)}},_callee7)}))()},listenComments:function listenComments(projectId,cb,cursor){var _commentListeners$get,listeners=null!==(_commentListeners$get=commentListeners.get(projectId))&&void 0!==_commentListeners$get?_commentListeners$get:new Map;return listeners.set(cb,cursor),commentListeners.set(projectId,listeners),Promise.resolve().then(function(){return cb(buildCommentPage(projectId,cursor))}),function(){var current=commentListeners.get(projectId);current&&(current.delete(cb),0===current.size&&commentListeners.delete(projectId))}},toggleLike:function toggleLike(projectId,userId){return _asyncToGenerator(_regenerator().m(function _callee8(){var _likesStore$get,project,likes,hasLiked;return _regenerator().w(function(_context8){for(;;)switch(_context8.n){case 0:if(project=projectStore.get(projectId)){_context8.n=1;break}throw new Error("Project not found");case 1:return likes=null!==(_likesStore$get=likesStore.get(projectId))&&void 0!==_likesStore$get?_likesStore$get:new Set,(hasLiked=likes.has(userId))?(likes.delete(userId),project.likesCount=Math.max(0,project.likesCount-1)):(likes.add(userId),project.likesCount+=1),likesStore.set(projectId,likes),upsertProject(project),_context8.a(2,{liked:!hasLiked,likesCount:project.likesCount})}},_callee8)}))()}}},"./src/lib/upload.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{B:()=>uploadProjectMediaFile,w:()=>compressImage});var browser_image_compression__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/browser-image-compression/dist/browser-image-compression.mjs"),nanoid__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/nanoid/index.browser.js"),firebase_storage__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/firebase/storage/dist/esm/index.esm.js"),_lib_firebaseClient__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./lib/firebaseClient.ts"),_src_config_constants__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/config/constants.ts");function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _regeneratorValues(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function next(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}throw new TypeError(_typeof(e)+" is not iterable")}function _regenerator(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var c=n&&n.prototype instanceof Generator?n:Generator,u=Object.create(c.prototype);return _regeneratorDefine2(u,"_invoke",function(r,n,o){var i,c,u,f=0,p=o||[],y=!1,G={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function d(t,r){return i=t,c=0,u=e,G.n=r,a}};function d(r,n){for(c=r,u=n,t=0;!y&&f&&!o&&t<p.length;t++){var o,i=p[t],d=G.p,l=i[2];r>3?(o=l===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=e):i[0]<=d&&((o=r<2&&d<i[1])?(c=0,G.v=n,G.n=i[1]):d<l&&(o=r<3||i[0]>n||n>l)&&(i[4]=r,i[5]=n,G.n=l,c=0))}if(o||r>1)return a;throw y=!0,n}return function(o,p,l){if(f>1)throw TypeError("Generator is already running");for(y&&1===p&&d(p,l),c=p,u=l;(t=c<2?e:u)||!y;){i||(c?c<3?(c>1&&(G.n=-1),d(c,u)):G.n=u:G.v=u);try{if(f=2,i){if(c||(o="next"),t=i[o]){if(!(t=t.call(i,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,c<2&&(c=0)}else 1===c&&(t=i.return)&&t.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=e}else if((t=(y=G.n<0)?u:r.call(n,G))!==a)break}catch(t){i=e,c=1,u=t}finally{f=1}}return{value:t,done:y}}}(r,o,i),!0),u}var a={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}t=Object.getPrototypeOf;var c=[][n]?t(t([][n]())):(_regeneratorDefine2(t={},n,function(){return this}),t),u=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(c);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,_regeneratorDefine2(e,o,"GeneratorFunction")),e.prototype=Object.create(u),e}return GeneratorFunction.prototype=GeneratorFunctionPrototype,_regeneratorDefine2(u,"constructor",GeneratorFunctionPrototype),_regeneratorDefine2(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName="GeneratorFunction",_regeneratorDefine2(GeneratorFunctionPrototype,o,"GeneratorFunction"),_regeneratorDefine2(u),_regeneratorDefine2(u,o,"Generator"),_regeneratorDefine2(u,n,function(){return this}),_regeneratorDefine2(u,"toString",function(){return"[object Generator]"}),(_regenerator=function _regenerator(){return{w:i,m:f}})()}function _regeneratorDefine2(e,r,n,t){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}_regeneratorDefine2=function _regeneratorDefine(e,r,n,t){function o(r,n){_regeneratorDefine2(e,r,function(e){return this._invoke(r,n,e)})}r?i?i(e,r,{value:n,enumerable:!t,configurable:!t,writable:!t}):e[r]=n:(o("next",0),o("throw",1),o("return",2))},_regeneratorDefine2(e,r,n,t)}function asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise(function(r,o){var a=n.apply(t,e);function _next(n){asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)})}}var isBrowser="undefined"!=typeof window;function getImageDimensions(_x){return _getImageDimensions.apply(this,arguments)}function _getImageDimensions(){return(_getImageDimensions=_asyncToGenerator(_regenerator().m(function _callee(blob){return _regenerator().w(function(_context){for(;;)switch(_context.n){case 0:if(isBrowser){_context.n=1;break}return _context.a(2,{width:0,height:0});case 1:return _context.a(2,new Promise(function(resolve,reject){var img=new Image;img.onload=function(){return resolve({width:img.width,height:img.height})},img.onerror=reject,img.src=URL.createObjectURL(blob)}))}},_callee)}))).apply(this,arguments)}function compressImage(_x2){return _compressImage.apply(this,arguments)}function _compressImage(){return _compressImage=_asyncToGenerator(_regenerator().m(function _callee2(file){var _opts$maxBytes,_opts$maxDimension,opts,maxSizeMB,maxWidthOrHeight,bitmap,scale,canvas,ctx,blob,_args2=arguments;return _regenerator().w(function(_context2){for(;;)switch(_context2.p=_context2.n){case 0:return maxSizeMB=(null!==(_opts$maxBytes=(opts=_args2.length>1&&void 0!==_args2[1]?_args2[1]:{}).maxBytes)&&void 0!==_opts$maxBytes?_opts$maxBytes:_src_config_constants__WEBPACK_IMPORTED_MODULE_4__.fD)/1048576,maxWidthOrHeight=null!==(_opts$maxDimension=opts.maxDimension)&&void 0!==_opts$maxDimension?_opts$maxDimension:_src_config_constants__WEBPACK_IMPORTED_MODULE_4__.md,_context2.p=1,_context2.n=2,(0,browser_image_compression__WEBPACK_IMPORTED_MODULE_0__.A)(file,{maxSizeMB,maxWidthOrHeight,useWebWorker:!0,maxIteration:10});case 2:return _context2.a(2,_context2.v);case 3:if(_context2.p=3,_context2.v,isBrowser){_context2.n=4;break}return _context2.a(2,file);case 4:if("undefined"!=typeof createImageBitmap){_context2.n=5;break}return _context2.a(2,file);case 5:return _context2.n=6,createImageBitmap(file);case 6:if(bitmap=_context2.v,scale=Math.min(1,maxWidthOrHeight/Math.max(bitmap.width,bitmap.height)),(canvas=document.createElement("canvas")).width=Math.max(Math.round(bitmap.width*scale),1),canvas.height=Math.max(Math.round(bitmap.height*scale),1),ctx=canvas.getContext("2d")){_context2.n=7;break}return _context2.a(2,file);case 7:return ctx.drawImage(bitmap,0,0,canvas.width,canvas.height),_context2.n=8,new Promise(function(resolve){return canvas.toBlob(resolve,"image/jpeg",.82)});case 8:if(blob=_context2.v){_context2.n=9;break}return _context2.a(2,file);case 9:return _context2.a(2,new File([blob],file.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))}},_callee2,null,[[1,3]])})),_compressImage.apply(this,arguments)}function uploadOnce(_x3,_x4,_x5,_x6,_x7){return _uploadOnce.apply(this,arguments)}function _uploadOnce(){return _uploadOnce=_asyncToGenerator(_regenerator().m(function _callee4(storage,path,file,fileName,onProgress){var attempt,fileRef,metadata,uploadTask,result,_args4=arguments;return _regenerator().w(function(_context4){for(;;)switch(_context4.n){case 0:return attempt=_args4.length>5&&void 0!==_args4[5]?_args4[5]:1,fileRef=(0,firebase_storage__WEBPACK_IMPORTED_MODULE_2__.KR)(storage,path),metadata={contentType:file.type||"application/octet-stream"},uploadTask=(0,firebase_storage__WEBPACK_IMPORTED_MODULE_2__.bp)(fileRef,file,metadata),_context4.n=1,new Promise(function(resolve,reject){uploadTask.on("state_changed",function(snapshot){var progress=Math.round(snapshot.bytesTransferred/snapshot.totalBytes*100);null==onProgress||onProgress({fileName,progress,attempt})},reject,_asyncToGenerator(_regenerator().m(function _callee3(){var downloadUrl,_yield$getImageDimens,width,height;return _regenerator().w(function(_context3){for(;;)switch(_context3.n){case 0:return _context3.n=1,(0,firebase_storage__WEBPACK_IMPORTED_MODULE_2__.qk)(uploadTask.snapshot.ref);case 1:return downloadUrl=_context3.v,_context3.n=2,getImageDimensions(file);case 2:_yield$getImageDimens=_context3.v,width=_yield$getImageDimens.width,height=_yield$getImageDimens.height,resolve({storagePath:path,downloadUrl,size:file.size,width,height,contentType:metadata.contentType});case 3:return _context3.a(2)}},_callee3)})))});case 1:return result=_context4.v,_context4.a(2,result)}},_callee4)})),_uploadOnce.apply(this,arguments)}function uploadProjectMediaFile(_x8,_x9){return _uploadProjectMediaFile.apply(this,arguments)}function _uploadProjectMediaFile(){return _uploadProjectMediaFile=_asyncToGenerator(_regenerator().m(function _callee5(projectId,file){var _options$storage,_options$retries,_options$pathPrefix,options,compressed,storage,retries,sanitizedName,storagePath,_loop,_ret,attempt,_args6=arguments;return _regenerator().w(function(_context6){for(;;)switch(_context6.n){case 0:return options=_args6.length>2&&void 0!==_args6[2]?_args6[2]:{},_context6.n=1,compressImage(file,{maxBytes:options.maxBytes,maxDimension:options.maxDimension});case 1:compressed=_context6.v,storage=null!==(_options$storage=options.storage)&&void 0!==_options$storage?_options$storage:(0,_lib_firebaseClient__WEBPACK_IMPORTED_MODULE_3__.tf)(),retries=null!==(_options$retries=options.retries)&&void 0!==_options$retries?_options$retries:_src_config_constants__WEBPACK_IMPORTED_MODULE_4__.mA,sanitizedName=file.name.toLowerCase().replace(/[^a-z0-9.]+/g,"-"),storagePath="".concat(null!==(_options$pathPrefix=options.pathPrefix)&&void 0!==_options$pathPrefix?_options$pathPrefix:_src_config_constants__WEBPACK_IMPORTED_MODULE_4__.M9,"/").concat(projectId,"/media/").concat(Date.now(),"-").concat((0,nanoid__WEBPACK_IMPORTED_MODULE_1__.Ak)(6),"-").concat(sanitizedName),_loop=_regenerator().m(function _loop(attempt){var _t2,_t3;return _regenerator().w(function(_context5){for(;;)switch(_context5.p=_context5.n){case 0:return _context5.p=0,_context5.n=1,uploadOnce(storage,storagePath,compressed,file.name,options.onProgress,attempt);case 1:return _t2=_context5.v,_context5.a(2,{v:_t2});case 2:if(_context5.p=2,_t3=_context5.v,attempt!==retries){_context5.n=3;break}throw _t3;case 3:return _context5.n=4,new Promise(function(resolve){return setTimeout(resolve,_src_config_constants__WEBPACK_IMPORTED_MODULE_4__.D0*attempt)});case 4:return _context5.a(2)}},_loop,null,[[0,2]])}),attempt=1;case 2:if(!(attempt<=retries)){_context6.n=5;break}return _context6.d(_regeneratorValues(_loop(attempt)),3);case 3:if(!(_ret=_context6.v)){_context6.n=4;break}return _context6.a(2,_ret.v);case 4:attempt+=1,_context6.n=2;break;case 5:throw new Error("uploadProjectMediaFile exhausted retries");case 6:return _context6.a(2)}},_callee5)})),_uploadProjectMediaFile.apply(this,arguments)}}}]);